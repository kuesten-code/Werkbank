@using Kuestencode.Shared.Contracts.Navigation
@inject IHostNavigationService NavigationService
@inject NavigationManager NavigationManager
@implements IDisposable

<MudNavMenu>
    @foreach (var navItem in _navItems)
    {
        <NavItemRenderer Item="navItem" CurrentUri="@_currentUri" />
    }
</MudNavMenu>

@code {
    private List<NavItemDto> _navItems = new();
    private string _currentUri = string.Empty;

    protected override void OnInitialized()
    {
        _currentUri = NavigationManager.Uri;
        NavigationManager.LocationChanged += HandleLocationChanged;
        _navItems = NavigationService.GetNavigationItems();
    }

    private void HandleLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        _currentUri = e.Location;
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= HandleLocationChanged;
    }
}
