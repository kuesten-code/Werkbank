@page "/customers"
@using Kuestencode.Core.Interfaces
@using Kuestencode.Core.Models
@using Kuestencode.Shared.Contracts.Host
@using Kuestencode.Shared.UI
@using Kuestencode.Shared.UI.Components
@inject ICustomerService CustomerService
@inject NavigationManager NavigationManager
@inject IDialogService DialogService
@inject ISnackbar Snackbar

<PageTitle>Kunden - KÃ¼stencode Werkbank</PageTitle>

<RoleGuard AllowedRoles="@(new List<UserRole> { UserRole.Buero, UserRole.Admin })" RedirectTo="/rapport">
<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h4" GutterBottom="true">Kundenverwaltung</MudText>

    <MudPaper Class="pa-4 mt-4">
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4">
            <MudTextField @bind-Value="_searchString" Placeholder="Suche nach Name oder Kundennummer"
                         Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                         IconSize="Size.Medium" Class="mt-0" Immediate="true" />
            <MudButton Variant="Variant.Filled" Color="Color.Primary"
                      StartIcon="@Icons.Material.Filled.Add" OnClick="CreateCustomer">
                Neuer Kunde
            </MudButton>
        </MudStack>

        <MudTable Items="@_filteredCustomers" Hover="true" Breakpoint="Breakpoint.Sm"
                 Loading="@_loading" LoadingProgressColor="Color.Info"
                 RowsPerPage="10">
            <HeaderContent>
                <MudTh>Kundennummer</MudTh>
                <MudTh>Name</MudTh>
                <MudTh>Stadt</MudTh>
                <MudTh>Email</MudTh>
                <MudTh Style="text-align: right">Aktionen</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Kundennummer">@context.CustomerNumber</MudTd>
                <MudTd DataLabel="Name">@context.Name</MudTd>
                <MudTd DataLabel="Stadt">@context.City</MudTd>
                <MudTd DataLabel="Email">@context.Email</MudTd>
                <MudTd DataLabel="Aktionen" Style="text-align: right">
                    <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                  Color="Color.Primary" Size="Size.Small"
                                  OnClick="@(() => EditCustomer(context.Id))" />
                    <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                  Color="Color.Error" Size="Size.Small"
                                  OnClick="@(() => DeleteCustomer(context))" />
                </MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="new int[] { 10, 25, 50, 100 }" />
            </PagerContent>
        </MudTable>
    </MudPaper>
</MudContainer>
</RoleGuard>
